r13700 | rubidium | 2008-07-14 20:22:15 +0200 (Mon, 14 Jul 2008) | 2 lines

-Fix: possible buffer overflow in string truncation code.

Index: src/gfx.cpp
===================================================================
--- src/gfx.cpp	(revision 13699)
+++ src/gfx.cpp	(revision 13700)
@@ -256,9 +256,10 @@
 			w += GetCharacterWidth(size, c);
 
 			if (w >= maxw) {
-				/* string got too big... insert dotdotdot */
-				ddd_pos[0] = ddd_pos[1] = ddd_pos[2] = '.';
-				ddd_pos[3] = '\0';
+				/* string got too big... insert dotdotdot, but make sure we do not
+				 * print anything beyond the string termination character. */
+				for (int i = 0; *ddd_pos != '\0' && i < 3; i++, ddd_pos++) *ddd_pos = '.';
+				*ddd_pos = '\0';
 				return ddd_w;
 			}
 		} else {
